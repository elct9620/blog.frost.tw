<!doctype html><html lang=en><head><title>Write a suitable RSpec test - Aotokitsuruya is learning</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Include me, write test is many people&amp;rsquo;s nightmare. Many junior programmers feel it is hard to define which should be tested. So, I decided to share my experience …"><meta name=created content="2020-02-20T00:00:00+0000"><meta name=modified content="2020-02-20T00:26:16+0000"><meta name=author content="蒼時弦也"><meta property="og:site_name" content="Aotokitsuruya is learning"><meta property="og:title" content="Write a suitable RSpec test"><meta property="og:url" content="https://blog.frost.tw/en/posts/2020/02/20/Write-a-suitable-RSpec-test/"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.frost.tw/images/2020-02-20-write-a-suitable-rspec-test/thumbnail.jpg"><meta name=theme-color content="#EFEFEF"><link href=https://blog.frost.tw/icon-512.png rel=icon><link rel=canonical href=https://blog.frost.tw/en/posts/2020/02/20/Write-a-suitable-RSpec-test/><link rel=alternate hreflang=zh-tw href=https://blog.frost.tw/posts/2020/02/20/Write-a-suitable-RSpec-test/><script type=application/ld+json>[{"@context":"https://schema.org","@type":"WebPage","headline":"Write a suitable RSpec test","datePublished":"2020-02-20T00:26:16Z","dateModified":"2020-02-20T00:26:16Z","url":"https://blog.frost.tw/en/posts/2020/02/20/Write-a-suitable-RSpec-test/","description":"Include me, write test is many people\u0026rsquo;s nightmare. Many junior programmers feel it is hard to define which should be tested. So, I decided to share my experience …\n","keywords":["Ruby","RSpec","Experience","BDD","TDD","Rails"],"image":"https://blog.frost.tw/images/2020-02-20-write-a-suitable-rspec-test/thumbnail.jpg","author":{"@type":"Person","name":"蒼時弦也"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.frost.tw/"},"publisher":{"@type":"Organization","name":"Aotokitsuruya is learning","url":"https://blog.frost.tw/"}},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://blog.frost.tw/","name":"Aotokitsuruya is learning","image":"http://blog.frost.tw/icon-512.png"}},{"@type":"ListItem","position":2,"item":{"@id":"https://blog.frost.tw/en/posts/2020/02/20/Write-a-suitable-RSpec-test/","name":"Write a suitable RSpec test","image":"https://blog.frost.tw/images/2020-02-20-write-a-suitable-rspec-test/thumbnail.jpg"}}]}]</script><link rel=stylesheet href=/css/styls.css><script async src=/js/turbolinks.min.js></script></head><body><div id=fb-root data-turbolinks-permanent></div><h1 id=sitename><a href=/en class="hide-text logo--icon align-center">Aotokitsuruya is learning</a></h1><aside id=slogan class="slogan align-center text-center"><h2 class=slogan__title>Aotokitsuruya</h2><p class=slogan__description>The Web is attracting me, so I start learning PHP, HTML, CSS and JavaScript. When I know about Ruby, I fall in love with it. Now, I working with my friend to design games using C++ and still learning web about Golang, Ruby and JavaScript. In the other side, I also be a designer, the reason why the web is attracted me.</p></aside><div id=wrapper><article class="post article" role=article><header class=article__header><time datetime=2020-02-20T00:26:16+0000 class=article__time--header role=time>Feb.20</time><h1 class=article__title>Write a suitable RSpec test</h1></header><div class=article__entry><nav class=translation><a class=translation__link href=https://blog.frost.tw/posts/2020/02/20/Write-a-suitable-RSpec-test/>繁體中文</a></nav><aside class=article__toc><header class=article__toc-title><h3>Table of Contents</h3></header><nav role=menuitem><nav id=TableOfContents><ul><li><a href=#the-pure-ruby-example>The Pure Ruby example</a></li><li><a href=#real-world-example>Real-world example</a></li><li><a href=#more-example-of-rails>More example of Rails</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></nav><hr></aside><p>Include me, write test is many people&rsquo;s nightmare. Many junior programmers feel it is hard to define which should be tested. So, I decided to share my experience after I tech my colleague today.</p><p>Before we start talking about how to write a test, let us stop thinking about anything about TDD or BDD or any you may read about it.</p><p>And ask yourself, what is &ldquo;test&rdquo;? Why we need a &ldquo;test&rdquo;?</p><p>The target we add the tests to our project usually to prevent human mistake, that means we try to let compute help us to confirm our code matches the &ldquo;spec&rdquo;.</p><p>But we have to know, the test still is human write code and the spec is human to decide. When you have the wrong spec and wrong way to test, we still get the wrong result.</p><p>So, let us try to keep everything simple, and you will feel happy when writing the test.</p><h2 id=the-pure-ruby-example>The Pure Ruby example</h2><p>In my experience, the test is related to your code. If you have bad code, and you will hard to test it. So, no matter you write the test before implementing anything or after it. The most important thing is the double-check which you want to test and fit your necessities.</p><p>Let&rsquo;s write a <code>Calculator</code> class, and try to test it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>Calculator</span>
  <span class=k>def</span> <span class=nf>initialize</span>
    <span class=vi>@inputs</span> <span class=o>=</span> <span class=o>[]</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>At first, we have a <code>Calculator</code> class with initialized <code>@inputs</code> array.</p><p>And we can create a simple RSpec skeleton.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=no>RSpec</span><span class=o>.</span><span class=n>describe</span> <span class=no>Calculator</span> <span class=k>do</span>
  <span class=n>let</span><span class=p>(</span><span class=ss>:calculator</span><span class=p>)</span> <span class=p>{</span> <span class=no>Calculator</span><span class=o>.</span><span class=n>new</span> <span class=p>}</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>And next, let us add the <code>#add</code> method to the calculator to allow it to add something.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>Calculator</span>
  <span class=k>def</span> <span class=nf>initialize</span>
    <span class=vi>@inputs</span> <span class=o>=</span> <span class=o>[]</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>number</span><span class=p>)</span>
    <span class=vi>@inputs</span> <span class=o>&lt;&lt;</span> <span class=n>number</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>perform</span>
    <span class=vi>@inputs</span><span class=o>.</span><span class=n>sum</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>And let&rsquo;s update our test</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=no>RSpec</span><span class=o>.</span><span class=n>describe</span> <span class=no>Calculator</span> <span class=k>do</span>
  <span class=n>let</span><span class=p>(</span><span class=ss>:calculator</span><span class=p>)</span> <span class=p>{</span> <span class=no>Calculator</span><span class=o>.</span><span class=n>new</span> <span class=p>}</span>

  <span class=n>describe</span> <span class=s1>&#39;#add&#39;</span> <span class=k>do</span>
    <span class=n>let</span><span class=p>(</span><span class=ss>:number</span><span class=p>)</span> <span class=p>{</span> <span class=mi>1</span> <span class=p>}</span>
    <span class=n>subject</span> <span class=p>{</span> <span class=n>calculator</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>number</span><span class=p>)</span> <span class=p>}</span>

    <span class=n>it</span> <span class=p>{</span> <span class=n>is_expected</span><span class=o>.</span><span class=n>to</span> <span class=kp>include</span><span class=p>(</span><span class=n>number</span><span class=p>)</span> <span class=p>}</span>
  <span class=k>end</span>

  <span class=n>describe</span> <span class=s1>&#39;#perform&#39;</span> <span class=k>do</span>
    <span class=n>subject</span> <span class=p>{</span> <span class=n>calculator</span><span class=o>.</span><span class=n>perform</span> <span class=p>}</span>

    <span class=n>before</span> <span class=p>{</span> <span class=n>calculator</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>}</span>

    <span class=n>it</span> <span class=p>{</span> <span class=n>is_expected</span><span class=o>.</span><span class=n>to</span> <span class=n>eq</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>}</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>In my experience, the best case is you can simply define a <code>subject</code> which is the target you want to test for, and we can use one line to test it. So I usually try to let my code can be tested like the above example.</p><blockquote><p>In the real world, it may not usually ideal. But this post we didn&rsquo;t discuss these case, maybe we can discuss in the future.</p></blockquote><h2 id=real-world-example>Real-world example</h2><p>After we have an imagination about the ideal test, let us try to apply it in the real world.</p><p>This morning we are discussing a legacy object which is the order&rsquo;s payment processor with my team member.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>PaymentService</span>
  <span class=k>def</span> <span class=nf>initialize</span><span class=p>(</span><span class=n>payment</span><span class=p>)</span>
    <span class=vi>@order</span> <span class=o>=</span> <span class=n>payment</span><span class=o>.</span><span class=n>order</span>
    <span class=vi>@payment</span> <span class=o>=</span> <span class=n>payment</span>
     <span class=c1># ...</span>
    <span class=n>setup</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>setup</span>
    <span class=vi>@payment</span><span class=o>.</span><span class=n>amount</span> <span class=o>=</span> <span class=n>amount</span>
    <span class=vi>@payment</span><span class=o>.</span><span class=n>currency</span> <span class=o>=</span> <span class=vi>@order</span><span class=o>.</span><span class=n>currency</span>
    <span class=c1># ...</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>perform</span>
    <span class=k>return</span> <span class=kp>false</span> <span class=k>unless</span> <span class=vi>@payment</span><span class=o>.</span><span class=n>valid?</span>

    <span class=no>ActiveRecord</span><span class=o>::</span><span class=no>Base</span><span class=o>.</span><span class=n>transaction</span> <span class=k>do</span>
       <span class=vi>@payment</span><span class=o>.</span><span class=n>save</span>
       <span class=no>VendorAPI</span><span class=o>.</span><span class=n>payment</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=ss>amount</span><span class=p>:</span> <span class=vi>@payment</span><span class=o>.</span><span class=n>amount</span><span class=p>)</span>
       <span class=c1># ...</span>
    <span class=k>end</span>
  <span class=k>end</span>

  <span class=kp>private</span>
  <span class=k>def</span> <span class=nf>amount</span>
    <span class=vi>@order</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=o>&amp;</span><span class=ss>:subtotal</span><span class=p>)</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>When we try to test this class, we notice it is very hard to add any test for it. Because the information is encapsulation inside the <code>@payment</code> but we cannot access it.</p><p>You may want to expose the <code>@payment</code> as an attribute like <code>service.payment.amount</code></p><p>But if we try to check for the amount is correct, our test code does not make sense.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=n>subject</span> <span class=p>{</span> <span class=n>service</span><span class=o>.</span><span class=n>payment</span><span class=o>.</span><span class=n>amount</span> <span class=p>}</span>
<span class=n>it</span> <span class=p>{</span> <span class=n>is_expected</span><span class=o>.</span><span class=n>to</span> <span class=n>eq</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=p>}</span>
</code></pre></td></tr></table></div></div><p>We test for the &ldquo;Service Object&rdquo; not the &ldquo;Payment Model&rdquo; inside it. According to this rule, the test should be like below.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=n>subject</span> <span class=p>{</span> <span class=n>service</span><span class=o>.</span><span class=n>amount</span> <span class=p>}</span>
<span class=n>it</span> <span class=p>{</span> <span class=n>is_expected</span><span class=o>.</span><span class=n>to</span> <span class=n>eq</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=p>}</span>
</code></pre></td></tr></table></div></div><p>At this moment, the &ldquo;subject&rdquo; correctly refers to the service&rsquo;s amount.</p><p>Let&rsquo;s refactor the <code>PaymentService</code> class to fit our expectations.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>PaymentService</span>
  <span class=k>def</span> <span class=nf>initialize</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
    <span class=vi>@order</span> <span class=o>=</span> <span class=n>order</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>amount</span>
    <span class=vi>@order</span><span class=o>.</span><span class=n>items</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=o>&amp;</span><span class=ss>:subtotal</span><span class=p>)</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>perform</span>
    <span class=n>payment</span> <span class=o>=</span> <span class=n>build_payment</span>
    <span class=k>return</span> <span class=kp>false</span> <span class=k>unless</span> <span class=n>payment</span><span class=o>.</span><span class=n>valid?</span>

    <span class=no>ActiveRecord</span><span class=o>::</span><span class=no>Base</span><span class=o>.</span><span class=n>transaction</span> <span class=k>do</span>
      <span class=n>payment</span><span class=o>.</span><span class=n>save</span>
      <span class=no>VendorAPI</span><span class=o>.</span><span class=n>payment</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=ss>amount</span><span class=p>:</span> <span class=n>amount</span><span class=p>)</span>
      <span class=c1># ...</span>
    <span class=k>end</span>
  <span class=k>end</span>

  <span class=kp>private</span>

  <span class=k>def</span> <span class=nf>build_payment</span>
    <span class=vi>@order</span><span class=o>.</span><span class=n>payments</span><span class=o>.</span><span class=n>build</span><span class=p>(</span>
      <span class=ss>amount</span><span class=p>:</span> <span class=n>amount</span><span class=p>,</span>
      <span class=ss>currency</span><span class=p>:</span> <span class=vi>@order</span><span class=o>.</span><span class=n>currency</span>
    <span class=p>)</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>After refactoring, the <code>PaymentService</code> is becoming more straight and we can focus tests on the <code>PaymentService</code>.</p><p>This is my experience when I design an object and I usually follow this rule in my work.</p><h2 id=more-example-of-rails>More example of Rails</h2><p>The Rails is the popular framework in Rubyist, I use it almost every workday. How can we use the above skills in Rails?</p><p>Just keep your class simple, and everything will be easier to test.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=c1># Model</span>
<span class=no>RSpec</span><span class=o>.</span><span class=n>describe</span> <span class=no>User</span> <span class=k>do</span>
  <span class=n>it</span> <span class=p>{</span> <span class=n>should</span> <span class=n>validate_presence_of</span><span class=p>(</span><span class=ss>:email</span><span class=p>)</span> <span class=p>}</span>
  <span class=c1># ...</span>

  <span class=n>describe</span> <span class=s2>&#34;#avatar_url&#34;</span> <span class=k>do</span>
    <span class=n>let</span><span class=p>(</span><span class=ss>:email</span><span class=p>)</span> <span class=p>{</span> <span class=s2>&#34;example@example.com&#34;</span> <span class=p>}</span>
    <span class=n>let</span><span class=p>(</span><span class=ss>:user</span><span class=p>)</span> <span class=p>{</span> <span class=n>create</span><span class=p>(</span><span class=ss>:user</span><span class=p>,</span> <span class=ss>email</span><span class=p>:</span> <span class=n>email</span><span class=p>)</span> <span class=p>}</span>
    <span class=n>subject</span> <span class=p>{</span> <span class=n>user</span><span class=o>.</span><span class=n>avatar_url</span> <span class=p>}</span>

    <span class=n>it</span> <span class=s2>&#34;returns Gravatar URL&#34;</span> <span class=k>do</span>
       <span class=n>digest</span> <span class=o>=</span> <span class=no>OpenSSL</span><span class=o>::</span><span class=no>Digest</span><span class=o>::</span><span class=no>MD5</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(</span><span class=n>email</span><span class=p>)</span>
       <span class=n>should</span> <span class=n>eq</span><span class=p>(</span><span class=s2>&#34;https://www.gravatar.com/avatar/</span><span class=si>#{</span><span class=nb>hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
    <span class=k>end</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>For the model, I usually prevent logic inside it. If your project is small and simple, it is ok to do this. But when your project is complex, we usually have to take several steps to process one thing. And that may be a signal to us to split it into an independent class to focus on this process (we usually call them service object)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=c1># Request</span>
<span class=no>RSpec</span><span class=o>.</span><span class=n>describe</span> <span class=s2>&#34;/api/users&#34;</span><span class=p>,</span> <span class=ss>type</span><span class=p>:</span> <span class=ss>:request</span> <span class=k>do</span>
   <span class=n>describe</span> <span class=s2>&#34;GET /api/users&#34;</span> <span class=k>do</span>
     <span class=n>let</span><span class=p>(</span><span class=ss>:users</span><span class=p>)</span> <span class=p>{</span> <span class=n>create_list</span><span class=p>(</span><span class=ss>:user</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=p>}</span>
     <span class=n>before</span> <span class=p>{</span> <span class=n>get</span> <span class=n>api_users_path</span> <span class=p>}</span>
     <span class=n>subject</span> <span class=p>{</span> <span class=n>response</span><span class=o>.</span><span class=n>code</span> <span class=p>}</span>
     <span class=n>it</span> <span class=p>{</span> <span class=n>should</span> <span class=n>eq</span><span class=p>(</span><span class=s2>&#34;200&#34;</span><span class=p>)</span> <span class=p>}</span>

     <span class=n>describe</span> <span class=s2>&#34;body&#34;</span> <span class=k>do</span>
       <span class=n>subject</span> <span class=p>{</span> <span class=no>JSON</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>body</span><span class=p>)</span> <span class=p>}</span>
       <span class=n>it</span> <span class=p>{</span> <span class=n>should_not</span> <span class=n>be_empty</span> <span class=p>}</span>
       <span class=c1># ...</span>
     <span class=k>end</span>
   <span class=k>end</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>If it is possible, I usually try to make my test more simple. It will help us to think about how to design our class is more clear and easier to use.</p><p>The above examples only cover very small parts of tests, but I think it is enough to show the suitable test usually depend on your code.</p><p>I still not used to write the test before I start work, and I also skip some tests if I have no time to write it.</p><p>But according to my experience, even you didn&rsquo;t write the test you still need to think about &ldquo;when I try to test my code, which is easier?&rdquo;</p><p>And then, you will notice the best practice we read from the net if we follow it and usually let our code easier to be tested.</p><p>For example, the junior will define a method mix different type return values.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>def</span> <span class=nf>sum</span>
  <span class=k>return</span> <span class=kp>false</span> <span class=k>if</span> <span class=n>summable?</span>

  <span class=vi>@items</span><span class=o>.</span><span class=n>sum</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>It will cause it hard to predict which type will be returned, and we need to write more test cases to confirm it.</p><h2 id=conclusion>Conclusion</h2><p>This may not an advanced skill, but I spend a lot of years to learn and try to write a test suitable.</p><p>And I notice my company&rsquo;s junior also has the same problem and feeling confusing when I ask them to try to refactor some legacy code.</p><p>They feel lost their way and didn&rsquo;t know where they can start to refactor the code.</p><p>So, when you feel confusing, just check for your code about:</p><ul><li>Is the test can focus on my class without depending on others?</li><li>Is my behavior is focused on one thing? (ex. Read and write, validate value, send an API request)</li><li>Is my method returns is expectable? (ex. the only number, object have the same interface)</li></ul><p>That sounds very simple and you may read about some object-oriented article about SOLID rules. But it still is hard to design it to a suitable state which didn&rsquo;t have too many over design.</p><p>Anyway, hope my article can help you find some inspiration when you try to write some tests.</p><footer class=article__footer><div class=text-center><div class=fb-share-button data-href="<%- page.permalink %>" data-layout=button_count></div></div><div class="text-center mt-1"><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:36px!important;height:37px!important;text-decoration:none!important;display:inline-flex!important;color:#fff!important;background-color:#000!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#fff!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/aotoki><img src=https://bmc-cdn.nyc3.digitaloceanspaces.com/BMC-button-images/BMC-btn-logo.svg alt="Buy me a Coffee"><span style=margin-left:5px>Buy me a Coffee</span></a></div><iframe scrolling=no frameborder=0 style="display:block;margin:0 auto;height:212px" src="https://button.like.co/in/embed/elct9620/button?referrer=<%- page.permalink %>"></iframe><ul class=article__tag-list><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Ruby/>Ruby</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/RSpec/>RSpec</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Experience/>Experience</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/BDD/>BDD</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/TDD/>TDD</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Rails/>Rails</a></li></ul></footer></div></article><div class=adv><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-2844969736316510 data-ad-slot=5530952976 data-ad-format=auto></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><section id=comment class=comment-box><h1 class=comment-box__title>Comments</h1><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"revo-skill-frost"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></section></div><footer id=footer><div id=copyright>&copy;2020 <a href="https://plus.google.com/117236344655673213049?rel=author" target=_blank rel=noreferrer>蒼時弦也</a>. All right reversed.</div></footer><script src=/js/app.min.e979702d4c2a76dd5e32acda7647b733e4959a8621df075338d00d2c6837e87a.js></script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5TQLRN" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5TQLRN');</script><script>window.fbAsyncInit=function(){FB.init({appId:'178355449110',xfbml:true,version:'v2.12'});FB.AppEvents.logPageView();};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/zh_TW/sdk.js";js.async=true
js.defer=true
fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));</script><div class=loading></div></body></html>