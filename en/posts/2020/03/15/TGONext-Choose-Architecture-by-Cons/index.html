<!doctype html><html lang=en><head><title>TGONext: Choose Architecture By Cons - Aotokitsuruya is learning</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="This meetup we review previous discussions and switch to the next topic. Based on the high concurrency we talk about the last meetup, we simulate an architecture and …"><meta name=created content="2020-03-15T00:00:00+0000"><meta name=modified content="2020-03-15T03:02:32+0800"><meta name=author content="蒼時弦也"><meta property="og:site_name" content="Aotokitsuruya is learning"><meta property="og:title" content="TGONext: Choose Architecture By Cons"><meta property="og:url" content="https://blog.frost.tw/en/posts/2020/03/15/TGONext-Choose-Architecture-by-Cons/"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.frost.tw/images/2020-03-15-tgonext-choose-architecture-by-cons/thumbnail.jpg"><meta name=theme-color content="#EFEFEF"><link href=https://blog.frost.tw/icon-512.png rel=icon><link rel=canonical href=https://blog.frost.tw/en/posts/2020/03/15/TGONext-Choose-Architecture-by-Cons/><link rel=alternate hreflang=zh-tw href=https://blog.frost.tw/posts/2020/03/15/TGONext-Choose-Architecture-by-Cons/><script type=application/ld+json>[{"@context":"https://schema.org","@type":"WebPage","headline":"TGONext: Choose Architecture By Cons","datePublished":"2020-03-15T03:02:32+08:00","dateModified":"2020-03-15T03:02:32+08:00","url":"https://blog.frost.tw/en/posts/2020/03/15/TGONext-Choose-Architecture-by-Cons/","description":"This meetup we review previous discussions and switch to the next topic. Based on the high concurrency we talk about the last meetup, we simulate an architecture and …\n","keywords":["Architecture","Microservice","Database","Experience","TGONext"],"image":"https://blog.frost.tw/images/2020-03-15-tgonext-choose-architecture-by-cons/thumbnail.jpg","author":{"@type":"Person","name":"蒼時弦也"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.frost.tw/"},"publisher":{"@type":"Organization","name":"Aotokitsuruya is learning","url":"https://blog.frost.tw/"}},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://blog.frost.tw/","name":"Aotokitsuruya is learning","image":"http://blog.frost.tw/icon-512.png"}},{"@type":"ListItem","position":2,"item":{"@id":"https://blog.frost.tw/en/posts/2020/03/15/TGONext-Choose-Architecture-by-Cons/","name":"TGONext: Choose Architecture By Cons","image":"https://blog.frost.tw/images/2020-03-15-tgonext-choose-architecture-by-cons/thumbnail.jpg"}}]}]</script><script async src=/js/turbolinks.min.js></script></head><body><div id=fb-root data-turbolinks-permanent></div><h1 id=sitename><a href=/en class="hide-text logo--icon align-center">Aotokitsuruya is learning</a></h1><aside id=slogan class="slogan align-center text-center"><h2 class=slogan__title>Aotokitsuruya</h2><p class=slogan__description>The Web is attracting me, so I start learning PHP, HTML, CSS and JavaScript. When I know about Ruby, I fall in love with it. Now, I working with my friend to design games using C++ and still learning web about Golang, Ruby and JavaScript. In the other side, I also be a designer, the reason why the web is attracted me.</p></aside><div id=wrapper><article class="post article" role=article><header class=article__header><time datetime=2020-03-15T03:02:32+0800 class=article__time--header>Feb.15</time><h1 class=article__title>TGONext: Choose Architecture By Cons</h1></header><div class=article__entry><nav class=translation><a class=translation__link href=https://blog.frost.tw/posts/2020/03/15/TGONext-Choose-Architecture-by-Cons/>繁體中文</a></nav><aside class=article__toc><header class=article__toc-title><h3>Table of Contents</h3></header><nav class=article__toc-list role=list><nav id=TableOfContents><ul><li><a href=#the-trap-inside-the-suggested-way>The trap inside the suggested way</a></li><li><a href=#will-microservice-rescue-us>Will microservice rescue us?</a></li><li><a href=#which-is-paid-for-an-architecture-choice>Which is paid for an architecture choice?</a><ul><li><a href=#domain-driven-design>Domain-Driven Design</a></li></ul></li><li><a href=#the-data-consistency>The data consistency</a></li><li><a href=#the-databases-evolution>The database&rsquo;s evolution</a><ul><li><a href=#rdbms>RDBMS</a></li><li><a href=#nosql>NoSQL</a></li><li><a href=#newsql>NewSQL</a></li></ul></li><li><a href=#the-choose-of-database>The choose of database</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></nav><hr></aside><p>This meetup we review previous discussions and switch to the next topic. Based on the high concurrency we talk about the last meetup, we simulate an architecture and evolution it.</p><h2 id=the-trap-inside-the-suggested-way>The trap inside the suggested way</h2><p>At first, we have a monolithic application put web server and database in the same machine.</p><pre><code>+-----------------------+
|+---------------------+|
||                     ||
||     Web Server      ||
||                     ||
|+---------------------+|
|+---------------------+|
||                     ||
||      Database       ||
||                     ||
|+---------------------+|
+-----------------------+
</code></pre><p>When the requests are growing, we will split the web server and database to the standalone machine.</p><pre><code>+---------------------+          +---------------------+
|                     |          |                     |
|     Web Server      &lt;----------&gt;      Database       |
|                     |          |                     |
+---------------------+          +---------------------+
</code></pre><p>When we feel it slow down again, we put a &ldquo;cache server&rdquo; to our architecture.
For example, a cache server is added between the web server and database server.</p><pre><code>+---------------------+      +---------------------+      +---------------------+
|                     |      |                     |      |                     |
|     Web Server      &lt;------&gt;    Cache Server     &lt;------&gt;      Database       |
|                     |      |                     |      |                     |
+---------------------+      +---------------------+      +---------------------+
</code></pre><p>When our cache crashed. The service will recovery after reboot or not?</p><blockquote><p>It may unable to recovery because the cache server lost everything when it restarts, and the webserver still sends a large number of requests to the cache server but passthrough to the database.</p></blockquote><p>This is the &ldquo;avalanche effect&rdquo;, one of our servers is failed and cause others to become unstable and finally let all service down.</p><p>Our mentor suggests to didn&rsquo;t add the cache server before our team member knows the pros and cons of the cache server, and know what happens the library or framework they are using.</p><h2 id=will-microservice-rescue-us>Will microservice rescue us?</h2><p>If we want to prevent the &ldquo;avalanche effect&rdquo;, you may associate it to the microservice which is popular in recent years.</p><p>The microservice is designed for &ldquo;decentralize&rdquo; which means each component can redeploy easily and work independently.</p><p>But it is too ideal, our service usually has some dependency on another service. For example, the webserver usually depends on the database.</p><p>This is another point we have to consider when we design an architecture.</p><p>In nowadays, the most popular way is to manage the dependency problem in microservice is to create a &ldquo;sidecar&rdquo; to control all community between components. The sidecar can know other services is alive or ready and report the status of the service which is managed.</p><p>Our mentor tells us an architecture solution usually depends on a problem that is designed to resolve it.</p><p>Another point is to find a problem in a microservice system, we have to know which service caused the issue. That means a microservice system needs a powerful log tracker to track each event inside the system.</p><h2 id=which-is-paid-for-an-architecture-choice>Which is paid for an architecture choice?</h2><p>After we learn some popular terms and the latest architecture design we start to discuss when should we use microservice.</p><p>Our mentor tells us the performance includes three concern:</p><ul><li>Throughput</li><li>Latency</li><li>Memory Footprint</li></ul><p>They will inflect each other which means if we choose one of them, the others should be paid for our gain.</p><p>In the microservice, it passes the packet inside the system to redirect it to the target services. That means the latency will be higher than other architecture, but it is decentralized and easier to create more components that we can easier to handle the growing incoming bandwidth.</p><p>The microservice uses latency to exchange more throughput to give us the ability to handle more requests.</p><p>But if our service requirements are low latency, the microservice will be a bad idea for our product.</p><h3 id=domain-driven-design>Domain-Driven Design</h3><p>The DDD is one of our topics, our mentor also let us think about why DDD becomes popular when microservice is becoming popular.</p><p>We can find a similar part is they are both considered by a &ldquo;domain.&rdquo; They try to let each service to focus on one business part. This is very different than the MVC we are using. And that is why the DDD is more close to the microservice&rsquo;s necessary.</p><p>On the other hand, if we want to use the microservice in our company. It depends on your company size and you have some problems to communicate with different departments. The microservice may be a good idea for each department to have its own service.</p><blockquote><p>But we have to consider the over design in our department.We may only need to create a monolithic application as the only service in our department or company. The microservice still have a lot of requirement and have too many services in one department may cause more problem.</p></blockquote><h2 id=the-data-consistency>The data consistency</h2><p>Besides the performance, another important part is the data inside our architecture. Each system has its own state and our service needs decide to use a strong consistency or eventual consistency and it should be discussed carefully.</p><p>For example, the bank system should be a strong consistency. You may not expect it shows your money does not exist after you save it into the bank. And after one hour it shows again after the bank finished the consistency check.</p><blockquote><p>The distributed system is a data consistency problem too.</p></blockquote><h2 id=the-databases-evolution>The database&rsquo;s evolution</h2><p>In a system, the database is directly related to the data consistency topics. Our mentor let us compare the RDBMS, NoSQL, and NewSQLs&rsquo; different.</p><h3 id=rdbms>RDBMS</h3><p>Before the RDBMS there has an Object-Oriented Database, but we didn&rsquo;t discuss it even the PostgreSQL has the trait of it.</p><blockquote><p>This is the first state of evolution and most common for us so we didn&rsquo;t discuss it too many at this time.</p></blockquote><h3 id=nosql>NoSQL</h3><p>In the NoSQL cases, we paid the consistency for throughput. This is why NoSQL has good scalability to let us can scale it very easily.</p><p>But NoSQL had to implement a lot of things in the application layer because the RDBMS does many things for us but NoSQL doesn&rsquo;t do that for us.</p><blockquote><p>Another trait is the NoSQL is depended on the SSD trait to change the data store design and give us a super-fast key-value type data access.</p></blockquote><h3 id=newsql>NewSQL</h3><p>The NewSQL is the reflection of NoSQL, people start thinking about NoSQL as a database is not enough. There have many things that should not implement on the application layer and should be done in the database.</p><p>Therefore they are starting to create a NewSQL that has strong consistency similar to RDBMS but has enough scalability capability.</p><blockquote><p>Currently, the NewSQL is not popular and didn&rsquo;t have a lot of Open Source solutions.</p></blockquote><h2 id=the-choose-of-database>The choose of database</h2><p>In the previous discussion, the mentor let us share our views about the reason to choose a database.</p><p>There have many cases to let us choose a database:</p><ul><li>The Database Feature</li><li>Framework</li><li>Team Member</li><li>Customer&rsquo;s preference</li></ul><p>There is no correct answer, like the above the architecture has many pros and cons in the different designs we discussed.</p><h2 id=conclusion>Conclusion</h2><p>This article lost a lot of detail, but I am out of my memory to write more details.</p><p>After the first meetup, I am worried about our discussion will stop at some calculate and knowledge we didn&rsquo;t know.</p><p>But in this meetup, our mentor gives us a new method or new viewpoint which we can apply to our work.</p><p>The most important thing is <strong>find the cons in your solution</strong> and review it before you decide to use it.</p><p>The pros usually give us benefits, but when our system has some trouble. The cons are the actual problem we have to face.</p><p>Therefore we have to choose an architecture with minimal damage to our product which means the cons didn&rsquo;t have too many conflicts with our product&rsquo;s requirements.</p><footer class=article__footer><div class=text-center><div class=fb-share-button data-href="<%- page.permalink %>" data-layout=button_count></div></div><div class="text-center mt-1"><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:36px!important;height:37px!important;text-decoration:none!important;display:inline-flex!important;color:#fff!important;background-color:#000!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#fff!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie&display=swap" rel=stylesheet><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/aotoki><img src=https://bmc-cdn.nyc3.digitaloceanspaces.com/BMC-button-images/BMC-btn-logo.svg rel=noreferrer alt="Buy me a Coffee"><span style=margin-left:5px>Buy me a Coffee</span></a></div><iframe title=LikeCoin scrolling=no frameborder=0 style="display:block;margin:0 auto;height:212px" src="https://button.like.co/in/embed/elct9620/button?referrer=<%- page.permalink %>"></iframe><ul class=article__tag-list><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Architecture/>Architecture</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Microservice/>Microservice</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Database/>Database</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/Experience/>Experience</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/en/tags/TGONext/>TGONext</a></li></ul></footer><aside class=related><header class=related__header><h3 class=related__title>See Also</h3></header><ul><li class=related__item><a class=related__link href=/en/posts/2020/02/23/TGONext-The-plan-for-high-concurrency/>TGONext: The plan for high concurrency</a></li><li class=related__item><a class=related__link href=/en/posts/2020/02/29/The-Reusable-Ansible-Role-Problem/>The Reusable Ansible Role Problem</a></li><li class=related__item><a class=related__link href=/en/posts/2020/02/20/Write-a-suitable-RSpec-test/>Write a suitable RSpec test</a></li></ul></aside></div></article><div class=subscribe><div id=mc_embed_signup><form action="https://frost.us4.list-manage.com/subscribe/post?u=dd3d68032c0510041f1302539&id=d2a668a8aa" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div id=mc_embed_signup_scroll><h1 class=subscribe__title>Newsletter</h2><div class=mc-field-group><input type=email name=EMAIL class="required email subscribe__input" id=mce-EMAIL placeholder=Email></div><div id=mce-responses class=clear><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_dd3d68032c0510041f1302539_d2a668a8aa tabindex=-1></div><div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class="button subscribe__button"></div></div></form></div></div><div class=adv><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-2844969736316510 data-ad-slot=5530952976 data-ad-format=auto></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><section id=comment class=comment-box><h1 class=comment-box__title>Comments</h1><div id=disqus_thread></div></div></section></div><footer id=footer><div id=copyright>&copy;2020 <a href="https://plus.google.com/117236344655673213049?rel=author" target=_blank rel=noreferrer>蒼時弦也</a>. All right reversed.</div></footer><link rel=stylesheet href=/css/styles.css><script src=/js/app.min.6e03bcf752b31ab875459fbdd360c766632ead24687ffe499c4cf1f86e9fe489.js></script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5TQLRN" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5TQLRN');</script><script>window.fbAsyncInit=function(){FB.init({appId:'178355449110',xfbml:true,version:'v2.12'});FB.AppEvents.logPageView();};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/zh_TW/sdk.js";js.async=true
js.defer=true
fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));</script><div class=loading></div></body></html>