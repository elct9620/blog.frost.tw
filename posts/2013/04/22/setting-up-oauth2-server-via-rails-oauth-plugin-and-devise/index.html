<!doctype html><html lang=zh-tw><head><title>使用 Oauth-Plugin 與 Devise 建置 OAuth2 伺服器 - 弦而時習之</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="其實，這是一篇掃雷文（誤
大約半年前（根據某人開 Issue 的記錄，是 7 個月之前）我也嘗試過安裝 oauth-plugin 來建置 OAuth2 伺服器，但是因為長達好幾小時 400 Bad Request 最後受不了而放棄。
這次，除了順利挑戰 Invalid OAuth Request 之外，從 400 甚至 401 都挑戰的 …"><meta name=created content="2013-04-22T00:00:00+0000"><meta name=modified content="0001-01-01T00:00:00+0000"><meta name=author content="蒼時弦也"><meta property="og:site_name" content="弦而時習之"><meta property="og:title" content="使用 Oauth-Plugin 與 Devise 建置 OAuth2 伺服器"><meta property="og:url" content="https://blog.frost.tw/posts/2013/04/22/setting-up-oauth2-server-via-rails-oauth-plugin-and-devise/"><meta property="og:type" content="article"><meta name=theme-color content="#EFEFEF"><link href=https://blog.frost.tw/icon-512.png rel=icon><link rel=canonical href=https://blog.frost.tw/posts/2013/04/22/setting-up-oauth2-server-via-rails-oauth-plugin-and-devise/><script type=application/ld+json>[{"@context":"https://schema.org","@type":"WebPage","headline":"使用 Oauth-Plugin 與 Devise 建置 OAuth2 伺服器","datePublished":"2013-04-22T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","url":"https://blog.frost.tw/posts/2013/04/22/setting-up-oauth2-server-via-rails-oauth-plugin-and-devise/","description":"其實，這是一篇掃雷文（誤\n大約半年前（根據某人開 Issue 的記錄，是 7 個月之前）我也嘗試過安裝 oauth-plugin 來建置 OAuth2 伺服器，但是因為長達好幾小時 400 Bad Request 最後受不了而放棄。\n這次，除了順利挑戰 Invalid OAuth Request 之外，從 400 甚至 401 都挑戰的 …\n","author":{"@type":"Person","name":"蒼時弦也"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.frost.tw/"},"publisher":{"@type":"Organization","name":"弦而時習之","url":"https://blog.frost.tw/"}},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/blog.frost.tw\/","name":"弦而時習之","image":"http:\/\/blog.frost.tw\/icon-512.png"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/blog.frost.tw\/posts\/2013\/04\/22\/setting-up-oauth2-server-via-rails-oauth-plugin-and-devise\/","name":"使用 Oauth-Plugin 與 Devise 建置 OAuth2 伺服器"}}]}]</script><link rel=stylesheet href=/css/styls.css><script async src=/js/turbolinks.min.js></script></head><body><div id=fb-root data-turbolinks-permanent></div><h1 id=sitename><a href=/ class="hide-text logo--icon align-center">弦而時習之</a></h1><aside id=slogan class="slogan align-center text-center"><h2 class=slogan__title>Aotokitsuruya</h2><p class=slogan__description>The Web is attracting me, so I start learning PHP, HTML, CSS and JavaScript. When I know about Ruby, I fall in love with it. Now, I working with my friend to design games using C++ and still learning web about Golang, Ruby and JavaScript. In the other side, I also be a designer, the reason why the web is attracted me.</p></aside><div id=wrapper><article class="post article" role=article><header class=article__header><time datetime=0001-01-01T00:00:00+0000 class=article__time--header role=time>Feb.22</time><h1 class=article__title>使用 Oauth-Plugin 與 Devise 建置 OAuth2 伺服器</h1></header><div class=article__entry><nav class=translation></nav><p>其實，這是一篇掃雷文（誤</p><p>大約半年前（根據某人開 Issue 的記錄，是 7 個月之前）我也嘗試過安裝 oauth-plugin 來建置 OAuth2 伺服器，但是因為長達好幾小時 <strong>400 Bad Request</strong> 最後受不了而放棄。</p><p>這次，除了順利挑戰 <strong>Invalid OAuth Request</strong> 之外，從 400 甚至 401 都挑戰的我，終於戰勝了地雷啊！</p><p>事不宜遲，讓我們開始進行這一連串的大戰吧！</p><h2 id=前情提要>###前情提要</h2><p>基本上，就是老爸公司的系統發展到某個程度後，開始有 SSO 的需求。因為系統本身是一個獎金計算的機制，為了搭配購物而在上週死命暴走把精簡版的訂單管理系統加入。</p><p>不過，客戶總不可能每個都天生神力自行開發購物車吧？因此就有了從來沒有停過的建構一個購物平台（基於原有系統）的輔助平台功能了（遠目</p><p>不過，多重的帳號與重複的資料是我們不樂見的，因此開始尋找 SSO (Single Sign-on) 的幾解決方案。</p><p>從 RubyCAS, BrowserID, OpenID, OAuth 都有評估，最後身為萬惡開發人員的我還是判斷 OAuth 最為適合。而 OAuth 2.0 也是我比較希望使用的模式，因此再次開啓失敗之路（誤</p><h2 id=現況分析>###現況分析</h2><p>因為目前主要的系統是使用 Rails 去進行開發的，所以就不考慮其他語言的實踐，以及 RubyCAS 需要另外建置伺服器的方式（另一方面是再開伺服器除了維護成本外，還有資金的限制，整合在現有系統內會是筆記好的選擇）</p><p>而目前 Ruby 大致上呈現 OAuth2 Client > OAuth2 Server 的狀況，相對的之後打算開發輔助平台的 PHP 則呈現 OAuth2 Server > OAuth2 Client 的狀態（此指的是實踐的容易程度）</p><p>在眾多 Ruby Gems 裡面，唯獨 oauth-plugin 較為完整（平均 OAuth2 相關 Gem 大多 7 個月沒有更新，因此差異不大）</p><h2 id=伺服器實作>###伺服器實作</h2><p>因為會員系統是基於 Devise 的，因此一開始就先考慮要搭配 Devise 實作。</p><p>建置上基本上參考 <a href=https://unhandledexpression.com/2011/06/02/Rails-and-oauth-plugin-part-1-the-provider/>Rails and OAuth-Plugin Part1</a> 這一篇文章</p><p>首先針對 Gemfile 追加 gems</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=n>gem</span> <span class=s1>&#39;devise&#39;</span>
<span class=n>gem</span> <span class=s1>&#39;oauth-plugin&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=s2>&gt;= 0.4.1</span><span class=s2>&#34;</span> <span class=c1># 使用最新的 0.4.1 版</span>
</code></pre></td></tr></table></div></div><p>接著執行 bundle install 進行安裝</p><blockquote><p>$ bundle install</p></blockquote><p>完成之後建置所需的 Controller / Model / View</p><blockquote><p>$ Rails g devise:install
$ Rails g devise User
$ Rails g oauth_provider</p></blockquote><p>然後更新資料庫
在這之前可以先修改 db/migrations 的 migrate 資訊，調整成所需的資料表結構</p><blockquote><p>$ rake db:migrate</p></blockquote><p>接下來修改 config/application.rb 加入 OAuth-Plugin 的 Middleware</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=nb>require</span> <span class=s1>&#39;oauth/rack/oauth_filter&#39;</span>
<span class=n>config</span><span class=o>.</span><span class=n>middleware</span><span class=o>.</span><span class=n>use</span> <span class=no>OAuth</span><span class=o>::</span><span class=no>Rack</span><span class=o>::</span><span class=no>OAuthFilter</span>
</code></pre></td></tr></table></div></div><p>註：上述程式碼不是在第一行/最後加入，而是在再 <code>class Application &lt; Rails::Application</code> 裡面</p><p>接下來編輯 User Model ( 前面 Rails g devise User 所產生的，依照你產生的 Model 修改 )</p><p>加入以下程式碼（對應 user 的 application 以及產生的 tokens）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=n>has_many</span> <span class=ss>:client_applications</span>
<span class=n>has_many</span> <span class=ss>:tokens</span><span class=p>,</span> <span class=ss>:class_name</span><span class=o>=</span><span class=o>&gt;</span><span class=s2>&#34;</span><span class=s2>OauthToken</span><span class=s2>&#34;</span><span class=p>,</span><span class=ss>:order</span><span class=o>=</span><span class=o>&gt;</span><span class=s2>&#34;</span><span class=s2>authorized_at desc</span><span class=s2>&#34;</span><span class=p>,</span><span class=ss>:include</span><span class=o>=</span><span class=o>&gt;</span><span class=o>[</span><span class=ss>:client_application</span><span class=o>]</span>
</code></pre></td></tr></table></div></div><p>註： <code>:include => [:client_application]</code> 這部分目前不確定是否適用，不過因為 oauth-plugin 的設計，預設也是無法修改此部分，在 Rails 3.2.13 仍是正常的</p><p>在參考文件中，會將 alias 分別放入 oauth_clients_controller.rb 和 oauth_controller.rb</p><p>不過這邊我們要改放到 application_controller.rb (後面會提到這個問題)</p><p>加入以下程式碼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=k>alias</span> <span class=ss>:logged_in?</span> <span class=ss>:user_signed_in?</span>
<span class=k>alias</span> <span class=ss>:loggin_required</span> <span class=ss>:authenticate_user!</span>
</code></pre></td></tr></table></div></div><p>上面的程式碼其實只是將 Devise 的方法提供給 OAuth-Plugin 而已（因為使用名稱不同，所以提供一個別名）</p><p>接著創建一些被 OAuth 保護的 Resources</p><blockquote><p>$ Rails g controller data index</p></blockquote><p>這部分就由各位自行處理</p><p>然後編輯這個 resources 加入 before_filter 為保護狀態</p><p>加入以下程式碼（相同於 before_filter 的位置）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=n>oauthenticate</span> <span class=c1># before_filter :oauth_required 的替代，也可傳入 :only =&gt; [:show, :index] 等</span>
</code></pre></td></tr></table></div></div><p>官方文件上所敘述的<code>before_filter :oauth_require</code> 只會呼叫 OAuth 1.0 的方法，即使順利取得 Access Token 附加在網址上發出請求，也會得到 401 的錯誤，因此改為使用 oauthenticate 就能夠正常（從原始碼來看，在 oauth_require 執行的時候是直接呼叫 oauth 1.0 的 method 而 oauthenticate 則是建立 filter 從 env 判斷版本）</p><p>最後依照參考資料補上一些必要的部分。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=k>def</span> <span class=nc></span><span class=o></span><span class=nf>current_user</span><span class=o>=</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
	<span class=n>current_user</span> <span class=o>=</span> <span class=n>user</span>
<span class=k>end</span>
</code></pre></td></tr></table></div></div><p>在原始碼中有使用到這個部分，需要額外補上</p><p>以及 Routes 設定中補上 oauth/revoke 的數值（不知道為什麼預設的 route 漏掉了⋯⋯）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Ruby data-lang=Ruby><span class=n>post</span> <span class=s1>&#39;oauth/revoke&#39;</span>
</code></pre></td></tr></table></div></div><p>直到這裡，就全部告一段落了！</p><p>另外 app/views/oauth_clients 裡面的 _form.html.erb, edit.html.erb, index.html.erb 使用很多舊版或者現在無法使用的語法，記得自行重寫，不然是無法正常運作的！</p><h2 id=客戶端實作>###客戶端實作</h2><p>解決完 Server 之後，就要來處理 Client 部分了（這部分使用 PHP 製作）</p><p>首先，到 Server 註冊好帳號、並且創建 Application 然後取得 Client Key, Client Secret 之後在繼續吧！</p><p>註：OAuth-Plugin 產生的 View 呈現的是 OAuth 1.0 的 Token 網址，後面會提到 2.0 所需使用的部分</p><p>首先，先進行 composer 的初始化</p><blockquote><p>$ composer init</p></blockquote><p>或者本地版本（我習慣把 composer 安裝到 /usr/local/bin 裡面方便使用 - MacOSX）</p><blockquote><p>PHP composer.phar init</p></blockquote><p>接著編輯 composer.json</p><p>在 require 裡面加入 OAuth Client 的實作</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=err>r</span><span class=err>e</span><span class=err>q</span><span class=err>u</span><span class=err>i</span><span class=err>r</span><span class=err>e</span><span class=err>:</span> <span class=p>{</span>
	<span class=nt>&#34;lncd/oauth2-client&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span> 
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>註：這邊是為了測試方便而使用這一個 Client 實際開發時還是建議用 <a href=https://code.google.com/p/oauth2-PHP/>OAuth2-PHP</a> 之類的 Library （以後有機會，會再寫一篇相關的文章討論 OAuth2 PHP Client 的使用心得）</p><p>完成後更新套件</p><blockquote><p>$ composer install</p></blockquote><p>或者 update (如果執行過 install)</p><blockquote><p>$ composer update</p></blockquote><p>因為這款 OAuth Client 是以 Provider 為基準的，因此我們要自行時做一個 Provider Class 來進行連接。</p><p>我是參考原有的 Provider 中 Github 的改寫</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-PHP data-lang=PHP><span class=cp>&lt;?PHP</span>

<span class=k>class</span> <span class=nc>MyProvider</span> <span class=k>extends</span> <span class=nx>OAuth2\Client\Provider\IdentityProvider</span>
<span class=p>{</span>
	<span class=k>public</span> <span class=nv>$respondType</span> <span class=o>=</span> <span class=s1>&#39;json&#39;</span><span class=p>;</span> <span class=c1>// 我們的伺服器預設為 json 這行可以省略
</span><span class=c1></span>	
	<span class=k>public</span> <span class=k>function</span> <span class=nf>urlAuthorize</span><span class=p>()</span> <span class=p>{</span>
		<span class=k>return</span> <span class=s2>&#34;https://myserver.dev/oauth/authorize&#34;</span><span class=p>;</span>
	<span class=p>}</span>
	
	<span class=k>public</span> <span class=k>function</span> <span class=nf>urlAccessToken</span><span class=p>()</span> <span class=p>{</span>
		<span class=k>return</span> <span class=s2>&#34;https://myserver.dev/oauth/token&#34;</span><span class=p>;</span> <span class=c1>// OAuth 2.0 使用這個即可，不過得在 rake routes 才會注意到它
</span><span class=c1></span>	<span class=p>}</span>
	
	<span class=c1>// 以下為 Client 本身實作，因為繼承的父類別會呼叫，因此須實做出來
</span><span class=c1></span>	<span class=k>public</span> <span class=k>function</span> <span class=nf>urlUserDetails</span><span class=p>(</span><span class=nx>OAuth2\Client\Token\AccessToken</span> <span class=nv>$token</span><span class=p>)</span> <span class=p>{</span>
		<span class=c1>// 這裡假設 Server 已經建立好 user_controller 並且以 OAuth 保護
</span><span class=c1></span>		<span class=k>return</span> <span class=s2>&#34;https://myserver.dev/user.json?access_token=&#34;</span> <span class=o>.</span> <span class=nv>$token</span><span class=p>;</span>
	<span class=p>}</span>
	
	<span class=k>public</span> <span class=k>function</span> <span class=nf>userDetails</span><span class=p>(</span><span class=nv>$response</span><span class=p>,</span> <span class=nx>OAuth2\Client\Token\AccessToken</span> <span class=nv>$token</span><span class=p>)</span>
	<span class=p>{</span>
	 	<span class=c1>// 預設是建立一個 User Object, 這裡只需看結果所以直接傳回 json_decode 後的資料
</span><span class=c1></span>		<span class=k>return</span> <span class=nv>$response</span><span class=p>;</span>
	<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>然後我們建立一個 index.PHP 來連接 OAuth 伺服器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-PHP data-lang=PHP><span class=cp>&lt;?PHP</span>

<span class=k>require</span> <span class=s1>&#39;vendor/autoload.PHP&#39;</span><span class=p>;</span> <span class=c1>// Composer 的 Autoload
</span><span class=c1></span><span class=k>require</span> <span class=s1>&#39;myProvider.PHP&#39;</span><span class=p>;</span> <span class=c1>// 剛剛建立的 Provider
</span><span class=c1></span>
<span class=nv>$provider</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MyProvider</span><span class=p>(</span><span class=k>Array</span><span class=p>(</span>
	<span class=s1>&#39;clientId&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;YOUR_CLIENT_KEY&#39;</span><span class=p>,</span>
	<span class=s1>&#39;clientSecret&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;YOUR_CLIENT_SECRET&#39;</span><span class=p>,</span>
	<span class=s1>&#39;redirectUri&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;https://myclient.dev/&#39;</span> <span class=c1>// 這是這個 PHP 運行的位置
</span><span class=c1></span><span class=p>));</span>

<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]))</span> <span class=p>{</span>
	<span class=nv>$provider</span><span class=o>-&gt;</span><span class=na>authorize</span><span class=p>();</span> <span class=c1>// 如果沒有取得 authorization code 則先進行認證
</span><span class=c1></span><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
	<span class=k>try</span> <span class=p>{</span>
		<span class=nv>$token</span> <span class=o>=</span> <span class=nv>$provider</span><span class=o>-&gt;</span><span class=na>getAccessToken</span><span class=p>(</span><span class=s1>&#39;authorization_code&#39;</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;code&#39;</span> <span class=o>=&gt;</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]));</span>
		
		<span class=k>try</span> <span class=p>{</span>
			<span class=nv>$user</span> <span class=o>=</span> <span class=nv>$provider</span><span class=o>-&gt;</span><span class=na>getUserDetails</span><span class=p>(</span><span class=nv>$token</span><span class=p>);</span>
			
			<span class=c1>// 傳回一些 $user 的資訊
</span><span class=c1></span>			
		<span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
			<span class=c1>// 取得資源失敗時的處理
</span><span class=c1></span>		<span class=p>}</span>
		
	<span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
		<span class=c1>// 處理取得 Access Token 失敗時的處理
</span><span class=c1></span>	<span class=p>}</span>
<span class=p>}</span>

</code></pre></td></tr></table></div></div><p>如果到此都順利完成，那就是完成 Server (Ruby) / Client (PHP) 的實作了！</p><p>據說某人從下午開始弄，弄到晚上十二點才全部解完，白白排了很多原始碼找問題</p><p>那麼，祝各位順利～</p><footer class=article__footer><div class=text-center><div class=fb-share-button data-href="<%- page.permalink %>" data-layout=button_count></div></div><div class="text-center mt-1"><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:36px!important;height:37px!important;text-decoration:none!important;display:inline-flex!important;color:#fff!important;background-color:#000!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#fff!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/aotoki><img src=https://bmc-cdn.nyc3.digitaloceanspaces.com/BMC-button-images/BMC-btn-logo.svg alt="Buy me a Coffee"><span style=margin-left:5px>Buy me a Coffee</span></a></div><iframe scrolling=no frameborder=0 style="display:block;margin:0 auto;height:212px" src="https://button.like.co/in/embed/elct9620/button?referrer=<%- page.permalink %>"></iframe></footer></div></article><div class=adv><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-2844969736316510 data-ad-slot=5530952976 data-ad-format=auto></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><section id=comment class=comment-box><h1 class=comment-box__title>留言</h1><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"revo-skill-frost"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></section></div><footer id=footer><div id=copyright>&copy;2020 <a href="https://plus.google.com/117236344655673213049?rel=author" target=_blank rel=noreferrer>蒼時弦也</a>. All right reversed.</div></footer><script src=/js/app.min.e979702d4c2a76dd5e32acda7647b733e4959a8621df075338d00d2c6837e87a.js></script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5TQLRN" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5TQLRN');</script><script>window.fbAsyncInit=function(){FB.init({appId:'178355449110',xfbml:true,version:'v2.12'});FB.AppEvents.logPageView();};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/zh_TW/sdk.js";js.async=true
js.defer=true
fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));</script><div class=loading></div></body></html>