<!DOCTYPE html><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>將遊戲場景帶入網頁 | 弦而時習之</title><meta name="theme-color" content="#EFEFEF"><meta name="author" content="蒼時弦也"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="description" content="昨晚公開了畢業製作的官網「遠古神話 - The Lost Mythologies」並且使用了「全景攝影技術」在網站上。喜歡我們的話請到粉絲專頁幫我們按個讚 XD沒想到反應還蠻熱烈的，雖然官網目前也只有全景預覽以及 LOGO 而已，不過似乎造成了一點點話題。那麼，這個效果到底是如何做出來的呢？這篇文章就會簡單的說明。主要的目標大致上有：順暢的瀏覽清晰的畫面全景圖片的製作"><meta name="keywords" content="前端,心得"><meta property="og:type" content="article"><meta property="og:title" content="將遊戲場景帶入網頁"><meta property="og:url" content="https://blog.frost.tw/posts/2015/01/13/bring-the-games-scene-into-webpage/"><meta property="og:site_name" content="弦而時習之"><meta property="og:description" content="昨晚公開了畢業製作的官網「遠古神話 - The Lost Mythologies」並且使用了「全景攝影技術」在網站上。喜歡我們的話請到粉絲專頁幫我們按個讚 XD沒想到反應還蠻熱烈的，雖然官網目前也只有全景預覽以及 LOGO 而已，不過似乎造成了一點點話題。那麼，這個效果到底是如何做出來的呢？這篇文章就會簡單的說明。主要的目標大致上有：順暢的瀏覽清晰的畫面全景圖片的製作"><meta property="og:locale" content="zh-TW"><meta property="og:image" content="https://user-image.logdown.io/user/52/blog/52/post/249663/09DVxMSTT6YJgZCgrXiw_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.43.46.png"><meta property="og:updated_time" content="2019-06-29T07:42:39.114Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="將遊戲場景帶入網頁"><meta name="twitter:description" content="昨晚公開了畢業製作的官網「遠古神話 - The Lost Mythologies」並且使用了「全景攝影技術」在網站上。喜歡我們的話請到粉絲專頁幫我們按個讚 XD沒想到反應還蠻熱烈的，雖然官網目前也只有全景預覽以及 LOGO 而已，不過似乎造成了一點點話題。那麼，這個效果到底是如何做出來的呢？這篇文章就會簡單的說明。主要的目標大致上有：順暢的瀏覽清晰的畫面全景圖片的製作"><meta name="twitter:image" content="https://user-image.logdown.io/user/52/blog/52/post/249663/09DVxMSTT6YJgZCgrXiw_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.43.46.png"><link rel="publisher" href="https://plus.google.com/117236344655673213049"><meta property="fb:app_id" content="178355449110"><meta property="fb:pages" content="180666522388"><script type="application/ld+json">[
{
    "@context": "https://schema.org",
    "@type": "Blog",
    "name": "弦而時習之",
    "url": "https://blog.frost.tw",
    "image": "http://blog.frost.tw/icon-512.png",
    "description": "蒼時弦也的個人網誌，專注在前端、後端以及遊戲開發，大多使用 Ruby 和 Ruby on Rails 以及 Golang、JS 和 C 語言。",
    "sameAs": [
      "https://www.facebook.com/frost.tw/"
    ]
},
{
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "蒼時弦也",
    "url": "https://blog.frost.tw",
    "sameAs": [
      "https://www.facebook.com/elct9620",
      "https://www.instagram.com/elct9620/",
      "https://twitter.com/elct9620",
      "https://plus.google.com/+%E8%92%BC%E6%99%82%E5%BC%A6%E4%B9%9F-plus",
      "https://www.linkedin.com/in/elct9620"
    ]
},
{
  "@context":"https://schema.org",
  "@type":"BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.frost.tw/posts/2015/01/13/bring-the-games-scene-into-webpage/"
  },
  "headline":"將遊戲場景帶入網頁",
  "image": [
    
    "https://user-image.logdown.io/user/52/blog/52/post/249663/09DVxMSTT6YJgZCgrXiw_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.43.46.png",
    
    "http://blog.frost.tw/icon-512.png"
  ],
  "thumbnailUrl": "https://user-image.logdown.io/user/52/blog/52/post/249663/09DVxMSTT6YJgZCgrXiw_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.43.46.png", 
  "datePublished": "2015-01-12T18:41:00.000Z",
  "dateModified": "2019-06-29T07:42:39.114Z",
  "description":"昨晚公開了畢業製作的官網「遠古神話 - The Lost Mythologies」並且使用了「全景攝影技術」在網站上。喜歡我們的話請到粉絲專頁幫我們按個讚 XD沒想到反應還蠻熱烈的，雖然官網目前也只有全景預覽以及 LOGO 而已，不過似乎造成了一點點話題。那麼，這個效果到底是如何做出來的呢？這篇文章就會簡單的說明。主要的目標大致上有：順暢的瀏覽清晰的畫面全景圖片的製作",
  "author": {
    "@type": "Person",
    "name": "蒼時弦也"
  },
  "publisher": {
    "@type": "Organization",
    "name": "蒼時弦也",
    "logo": "https://blog.frost.tw/icon-512.png"
  }
},
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item": {
      "@id": "https://blog.frost.tw",
      "name": "弦而時習之 ",
      "image": "http://blog.frost.tw/icon-512.png"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item": {
      "@id": "https://blog.frost.tw/posts/2015/01/13/bring-the-games-scene-into-webpage/",
      "name": "將遊戲場景帶入網頁",
      "image": "https://user-image.logdown.io/user/52/blog/52/post/249663/09DVxMSTT6YJgZCgrXiw_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.43.46.png"
    }
  }]
}
,
{
"@context": "https://schema.org",
  "@type": "Organization",
  "name": "蒼時弦也",
  "url": "https://blog.frost.tw",
  "logo": "https://blog.frost.tw/icon-512.png"
}
]</script><link rel="canonical" href="https://blog.frost.tw/posts/2015/01/13/bring-the-games-scene-into-webpage/"><link href="/icon-512.png" rel="icon"><link rel="alternate" href="/feed.xml" title="弦而時習之" type="application/rss+xml"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><script async src="/js/turbolinks.js"></script></head><body><div id="fb-root" data-turbolinks-permanent></div><header id="header"><h1 id="sitename"><a href="/" class="hide-text logo--icon align-center">弦而時習之</a></h1><aside id="slogan" class="slogan align-center text-center"><h2 class="slogan__title">Aotokitsuruya</h2><p class="slogan__description">The Web is attracting me, so I start learning PHP, HTML, CSS and JavaScript. When I know about Ruby, I fall in love with it. Now, I working with my friend to design games using C++ and still learning web about Golang, Ruby and JavaScript. In the other side, I also be a designer, the reason why the web is attracted me.</p></aside></header><div id="wrapper"><article class="post article"><header class="article__header"><time datetime="2015-01-12T18:41:00.000Z" class="article__time--header">Jan.13</time><h1 class="article__title">將遊戲場景帶入網頁</h1></header><div class="article__entry"><p>昨晚公開了畢業製作的官網「<a href="https://www.make.moe" rel="external nofollow noopener noreferrer" target="_blank">遠古神話 - The Lost Mythologies</a>」並且使用了「全景攝影技術」在網站上。</p><blockquote><p>喜歡我們的話請到<a href="https://www.facebook.com/Basaltic.Studio?fref=nf" rel="external nofollow noopener noreferrer" target="_blank">粉絲專頁</a>幫我們按個讚 XD</p></blockquote><p>沒想到反應還蠻熱烈的，雖然官網目前也只有全景預覽以及 LOGO 而已，不過似乎造成了一點點話題。</p><p>那麼，這個效果到底是如何做出來的呢？這篇文章就會簡單的說明。</p><p>主要的目標大致上有：</p><ul><li>順暢的瀏覽</li><li>清晰的畫面</li><li>全景圖片的製作</li></ul><a id="more"></a><p>事實上，這個技術其實不是很新的技術。像是 Google 街景就是運用的範例之一，而實做的效果則是源自於 othree 大大的 <a href="https://Github.com/othree/360-panorama" rel="external nofollow noopener noreferrer" target="_blank">360-panorama</a> 這個範例（約兩年前的 Happy Designer Mini 活動分享）</p><h3 id="全景圖製作"><a href="#全景圖製作" class="headerlink" title="全景圖製作"></a>全景圖製作</h3><p>要做出全景效果，我們必須先有全景圖才能夠開始。</p><p>在遊戲中通常只有 Perspective / Orthographic 兩種攝影機可以使用，我們第一個目標就是要把它當作「相機」來進行操作。<br>跟一般相機比較接近的是 Perspective Camera 因此我們選擇利用這個 Camera 來做攝影的動作。</p><p>那麼，該怎麼截圖才對呢？可以參考網路上非常多的「<a href="https://www.lazybox.com.tw/forum/fancystuff/photodiary/10335-87-lightroom--15-" rel="external nofollow noopener noreferrer" target="_blank">全景攝影教學</a>」的做法，利用拼接數張相片來達成這個效果。</p><blockquote><p>在 Prespective Camera 中，可以設定 Field of View (FOV) 這個設定值，最大可以達到 170 ~ 180 左右，簡單說就是廣角鏡頭的效果，能夠讓視野變得非常大，但是同時也讓畫面變形到無法辨識，因此這種方式是不可行的。</p></blockquote><p>為了取得比較沒有變形的遊戲畫面，一般依照預設值使用 FOV = 90 / Aspect = 1.7778 即可（Aspect 為長寬比，而 1.7778 是目前較常見的 16:9 螢幕大小，不過實際上拼接後無影響）</p><blockquote><p>在 Unreal Engine 中 Aspect 的大小會影響輸出檔案的解析度，當 Aspect 越小，解析度低也因次需要利用 HighResoultion Screenshot 工具的 Scale 功能去放大，但是放大次數太多會讓你的顯卡暴斃，因此設定 1.7778 的 Aspect 會比較恰當，大致上只需要做到 2 ~ 3 的 Scale 就足夠了！</p></blockquote><h4 id="Unreal-Engine-的攝影機架設與設定"><a href="#Unreal-Engine-的攝影機架設與設定" class="headerlink" title="Unreal Engine 的攝影機架設與設定"></a>Unreal Engine 的攝影機架設與設定</h4><p>因為是使用 Unreal Engine 來製作的，所以這邊就用 Unreal Engine 來示範架設攝影機的處理。</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/09DVxMSTT6YJgZCgrXiw_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.43.46.png" alt="螢幕快照 2015-01-13 上午11.43.46.png"></p><p>首先我們先加入一個拍攝用的攝影機在希望拍攝全景圖場景的位置（之後可以刪掉，如果用不上的話⋯⋯）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/4V6cxZEJTrGvnTy9wip4_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.46.15.png" alt="螢幕快照 2015-01-13 上午11.46.15.png"></p><p>接下來調整攝影機位置到正確的點，這邊最重要的地方是把 (X, Y, Z) 三軸的旋轉都歸零，以免待會拍攝的時候發生問題。</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/0HCJoRfFTNKHA54pvWCi_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.47.21.png" alt="螢幕快照 2015-01-13 上午11.47.21.png"></p><p>Unreal Engine 中有「Lock Viewport to Actor」的功能，利用這個功能將編輯器畫面對應到用來拍攝全景圖的攝影機上（主要是因為 Unreal Engine 的 Screenshot 功能是以編輯器的視窗為主）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/roHN3olCQWbT0BVORWMP_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.50.38.png" alt="螢幕快照 2015-01-13 上午11.50.38.png"></p><p>接下來隱藏掉一些不想出現在畫面上的物件（Ex. 小怪、遮蔽視線的物體）然後將 Realtime 功能關閉，開啟 Gameview 狀態讓編輯器畫面呈現「接近遊戲畫面」的狀態方便拍攝（過程不要點到場景物件，以免被拍到控制項）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/6WjH80jJQwSog6ENHhyd_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.51.08.png" alt="螢幕快照 2015-01-13 上午11.51.08.png"></p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/rKN3lddTj61hyg7UfIhY_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8A%E5%8D%8811.51.21.png" alt="螢幕快照 2015-01-13 上午11.51.21.png"></p><p>接下來開啟 High Resloution Screenshot 功能拍攝高畫質的全景圖吧！關於 Screenshot Size Multipler 的設定，就看大家的需求調整摟！（以我的解析度設定為 3 大概可以拿到約 600 萬畫素的截圖）</p><p>至於要拍攝幾張呢？以我的經驗來說約 26 張差不多就足夠了！</p><p>大約是以下幾個組合：</p><ul><li>8 張 (X=0, Y=0, Z=n) n = i * 45</li><li>8 張 (X=0, Y=45, Z=n) n = i * 45</li><li>8 張 (X=0, Y=-45, Z=n) n = i * 45</li><li>2 張 (X=0, Y=n, Z=0) n = (i - 1) * 90 (+90 跟 -90)</li></ul><p>我們會使用「正射投影法」貼到一顆球體上，之後再轉為「等距圓柱投影」的圖片作為輸出。</p><blockquote><p>最後兩張是用來填補天空和地板的洞，而 Y = +/-45 也是類似，都是補足 FOV=90 視野不夠廣闊問題的輔助圖<br>突然發現地理課學的投影法在神秘的情況下竟然用到了，雖然用軟體完全沒差啊～～～</p></blockquote><p>注意：重點在於每張圖片都要跟其他圖片有「重複且可辨識」的部分</p><h4 id="拼接全景圖"><a href="#拼接全景圖" class="headerlink" title="拼接全景圖"></a>拼接全景圖</h4><p>因為 Lightroom 有點大，所以就用了 OpenSource 的軟體 <a href="https://hugin.sourceforge.net" rel="external nofollow noopener noreferrer" target="_blank">Hugin</a> 來製作（其實非常好用）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/MK3J09cTyeuF42BImv5y_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.01.22.png" alt="螢幕快照 2015-01-13 下午12.01.22.png"></p><p>Mac 上打開會出現錯誤，按取消之後一樣可以正常使用（意義不明 XDD）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/lGA9IJjjTS9FMywSRslr_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.02.08.png" alt="螢幕快照 2015-01-13 下午12.02.08.png"></p><p>開啟後選擇左上角的「載入圖片」一次選取剛剛全部拍攝的 26 張圖片後，會先詢問鏡頭的數據。</p><blockquote><p>這邊先填寫「焦距比」的設定值，也就是 Aspect 設定的 1.7778 然後再輸入水平視角的角度 FOV=90 度，最後會自動計算出焦距<br>據說教學文章上說用 15mm ~ 25mm 的鏡頭會比較有透視感，但是遊戲攝影機拍出來隨便都 15mm 以下，到底是多有透視感啊 XDDD</p></blockquote><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/kVa7Kq2dRDuY4dt1NLX2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.04.55.png" alt="螢幕快照 2015-01-13 下午12.04.55.png"></p><p>設定完畢後會發現畫面非常的奇怪，感覺只是單純地把圖片貼到球體上而已。不過這是正常情況（正射投影預設就是這樣啊 XD）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/Uxog8yFLQs4n6cesVf67_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.06.14.png" alt="螢幕快照 2015-01-13 下午12.06.14.png"></p><p>點選「對準」按鈕之後，會開始計算這 26 張圖片的「重複」部分，並且以此為基準作為「對齊」的基準點。</p><p>註：也因此，前面一個步驟視野 90 度卻用 45 度旋轉的理由就出現了（不然手動對齊可是會崩潰的）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/diIjA5SnRUmMfc7v9lBN_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.08.33.png" alt="螢幕快照 2015-01-13 下午12.08.33.png"></p><p>在預覽模式下可以看到軟體基本上算出了近百個對齊點才抓到正確的拼接參考，因此拍攝時多花點時間讓重複的部分夠多才能讓軟體自動的拼接。</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/DJ7mYBFPTgedqzDMput4_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.10.07.png" alt="螢幕快照 2015-01-13 下午12.10.07.png"></p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/9R8GP1HWRJexI8sTDlLi_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.11.36.png" alt="螢幕快照 2015-01-13 下午12.11.36.png"></p><p>不過這時候可能會發現場景是上下顛倒的（不一定）這時候就利用移動/拖曳的功能，矯正場景到正確的位置。<br>（這會影響到一開始的全景預覽位置是否正確，以及是否會有強烈的傾斜感）</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/m5R9U3BBQfiXJy5Ah7u2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.13.21.png" alt="螢幕快照 2015-01-13 下午12.13.21.png"></p><p>最後到投影設定檢查是否為「等距長方圓柱」這個設定值，確認無誤之後就可以進行輸出了！</p><p><img src="https://user-image.logdown.io/user/52/blog/52/post/249663/8Js5Lw5RS6qWA3W62N1z_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-01-13%20%E4%B8%8B%E5%8D%8812.14.27.png" alt="螢幕快照 2015-01-13 下午12.14.27.png"></p><p>存好等距長方圓柱投影的貼圖後，就可以開始來製作 3D 的投影網頁場景摟！</p><h3 id="Three-js-WebGL-全景預覽"><a href="#Three-js-WebGL-全景預覽" class="headerlink" title="Three.js + WebGL 全景預覽"></a>Three.js + WebGL 全景預覽</h3><p>基本上參考文章一開始提到 othree 大大所寫的全景預覽 three.js 版本即可（其實裡面有提到用 Cube 模式會比較好，其實那就是 Skybox 的方式，不過一切看個人喜好，至少圓柱投影的版本效果就很不錯了！）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>基本上很簡單，給予一個 HTML 容器用來放置 Three.js 的 Canvas 即可。</p><p>然後就是寫 Three.js 的控制項（基本上都參照 othree 大大的寫法～～）</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="params">(e)</span> -&gt;</span></span><br><span class="line">  <span class="comment"># 網頁讀取完畢後產生場景</span></span><br><span class="line">  <span class="keyword">new</span> Scene(<span class="built_in">document</span>.getElementById(<span class="string">'container'</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scene</span></span></span><br><span class="line">  constructor: <span class="function"><span class="params">(container)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># 初始化變數</span></span><br><span class="line">    @_isInteracting = <span class="literal">false</span></span><br><span class="line">    @_onMouseDownX = <span class="number">0</span></span><br><span class="line">    @_onMouseDownY = <span class="number">0</span></span><br><span class="line">    @_lon= <span class="number">0</span></span><br><span class="line">    @_lat = <span class="number">0</span></span><br><span class="line">    @_phi = <span class="number">0</span></span><br><span class="line">    @_onMouseDownLon = <span class="number">0</span></span><br><span class="line">    @_onMouseDownLat = <span class="number">0</span></span><br><span class="line">    @_theta = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    @container = container</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 創建攝影機（FOV=70 左右比較感覺不出變形）</span></span><br><span class="line">    <span class="comment"># window.innerWidth / window.innerHeight 是計算 Aspect 的公式（因為是佔滿畫面所以直接這樣使用）</span></span><br><span class="line">    @camera = <span class="keyword">new</span> THREE.PerspectiveCamera <span class="number">70</span>, <span class="built_in">window</span>.innerWidth / <span class="built_in">window</span>.innerHeight, <span class="number">1</span>, <span class="number">1100</span></span><br><span class="line">    @camera.target = <span class="keyword">new</span> THREE.Vector3 <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 產生場景</span></span><br><span class="line">    @scene = <span class="keyword">new</span> THREE.Scene()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 產生物件</span></span><br><span class="line">    @mesh = <span class="keyword">new</span> THREE.Mesh(</span><br><span class="line">      <span class="keyword">new</span> THREE.SphereGeometry( <span class="number">500</span>, <span class="number">60</span>, <span class="number">40</span> ), <span class="comment"># 產生球體（半徑、寬分段、高分段）</span></span><br><span class="line">      <span class="keyword">new</span> THREE.MeshBasicMaterial ( &#123; <span class="comment"># 設定材質</span></span><br><span class="line">        map: THREE.ImageUtils.loadTexture( <span class="string">' /img/temple.jpg'</span> ) <span class="comment"># 貼圖為剛剛輸出的全景圖</span></span><br><span class="line">      &#125; )</span><br><span class="line">    )</span><br><span class="line">    @mesh.scale.x = <span class="number">-1</span> <span class="comment"># 反轉 Normal （讓原本顯示在外表的材質變到內部）</span></span><br><span class="line">    @scene.add @mesh <span class="comment"># 在場景加入這個物件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 產生繪圖器，這邊是用 WebGL 的版本（似乎有些人的電腦不支援看不到，還需要做支援性修正）</span></span><br><span class="line">    @renderer = <span class="keyword">new</span> THREE.WebGLRenderer()</span><br><span class="line">    @renderer.setSize( <span class="built_in">window</span>.innerWidth, <span class="built_in">window</span>.innerHeight ) <span class="comment"># 畫面大小等於網頁畫面</span></span><br><span class="line"></span><br><span class="line">truetrue<span class="comment"># 加到網頁中</span></span><br><span class="line">    container.appendChild @renderer.domElement</span><br><span class="line"></span><br><span class="line">    @bindEvents()</span><br><span class="line">    @animate() <span class="comment"># 開始播放動畫</span></span><br><span class="line"></span><br><span class="line">  bindEvents: <span class="function">=&gt;</span></span><br><span class="line">  	<span class="comment"># 處理滑鼠事件</span></span><br><span class="line">    <span class="built_in">document</span>.addEventListener <span class="string">'mousedown'</span>, @onMouseDown, <span class="literal">false</span></span><br><span class="line">    <span class="built_in">document</span>.addEventListener <span class="string">'mousemove'</span>, @onMouseMove, <span class="literal">false</span></span><br><span class="line">    <span class="built_in">document</span>.addEventListener <span class="string">'mouseup'</span>, @onMouseUp, <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">truetrue<span class="comment"># 處理縮放事件（不過我用 addEventListener 卻收不到，很奇怪）</span></span><br><span class="line">    <span class="built_in">window</span>.onresize = @onWindowResize</span><br><span class="line">    <span class="comment"># window.addEventListener 'resize', @onWinodwResize, false</span></span><br><span class="line"></span><br><span class="line">  animate: <span class="function">=&gt;</span></span><br><span class="line">    <span class="comment"># HTML5 的動畫處理函示（ 其實要 Fallback 回去 setTimeout ）</span></span><br><span class="line">    requestAnimationFrame( @animate )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果沒有在「拖曳」場景的話，自動旋轉 Lon ( Lon / Lat 應該是用經緯度表示法 )</span></span><br><span class="line">    <span class="keyword">if</span> @_isInteracting <span class="keyword">is</span> <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> @_lon &lt; <span class="number">360</span></span><br><span class="line">        @_lon = @_lon + <span class="number">0.015</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        @_lon = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    @render()</span><br><span class="line"></span><br><span class="line">  render: <span class="function">-&gt;</span></span><br><span class="line"></span><br><span class="line">    @_lat = Math.max( - <span class="number">85</span>, Math.min( <span class="number">85</span>, @_lat ) ) <span class="comment"># 限制仰角只能在 +/- 85 度以內（其實就是地板跟天花板的洞讓你看不到）</span></span><br><span class="line">    @_phi = THREE.Math.degToRad( <span class="number">90</span> - @_lat ) <span class="comment"># 將角度轉為弧度</span></span><br><span class="line">    @_theta = THREE.Math.degToRad( @_lon )</span><br><span class="line"></span><br><span class="line">truetrue<span class="comment"># 下面是計算攝影機面向的位置</span></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    <span class="comment"># 因為數學不好，看了很多資料覺得很崩潰（以下是利用公式計算，解釋會盡力表達）</span></span><br><span class="line">    <span class="comment"># 資料：球座標系統 - https://zh.wikipedia.org/wiki/%E7%90%83%E5%9D%90%E6%A8%99%E7%B3%BB</span></span><br><span class="line">    <span class="comment"># 資料：弧度 - https://zh.wikipedia.org/wiki/%E5%BC%A7%E5%BA%A6</span></span><br><span class="line">    <span class="comment"># 資料：反三角函數 - https://zh.wikipedia.org/wiki/%E5%8F%8D%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0</span></span><br><span class="line">    <span class="comment"># 資料：JavaScript Math - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sin</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 1. 首先將 deg 轉 rad 是因為程式中接收的都是 radius （耍笨想很久沒想通 XD）</span></span><br><span class="line">    <span class="comment"># 2. 球體座標系統定義了 （距離, 仰角, 方位角) 三個數值</span></span><br><span class="line">    <span class="comment"># 3. 所以 500 = r (距離)</span></span><br><span class="line">    <span class="comment"># 4. 3D 中通常是 Y-up 軸向設計，因此與球體座標系統的 Z-up 不同，將 Y &amp; Z 軸的對調</span></span><br><span class="line">    <span class="comment"># 5. 中間推算的過程不好寫，大家自己慢慢推吧（上面幾個資料加上三角函數的資料總有一天可以推出來的⋯⋯我推不出來 XD）</span></span><br><span class="line">    </span><br><span class="line">    @camera.target.x = <span class="number">500</span> * Math.sin( @_phi ) * Math.cos( @_theta )</span><br><span class="line">    @camera.target.y = <span class="number">500</span> * Math.cos( @_phi )</span><br><span class="line">    @camera.target.z = <span class="number">500</span> * Math.sin( @_phi ) * Math.sin( @_theta )</span><br><span class="line"></span><br><span class="line">truetrue<span class="comment"># 讓攝影機注視這個點（面向）</span></span><br><span class="line">    @camera.lookAt @camera.target</span><br><span class="line"></span><br><span class="line">truetrue<span class="comment"># 重新繪製畫面</span></span><br><span class="line">    @renderer.render @scene, @camera</span><br><span class="line"></span><br><span class="line">  onMouseDown: <span class="function"><span class="params">(e)</span> =&gt;</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"></span><br><span class="line">    @_isInteracting = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    @_onMouseDownX = e.clientX</span><br><span class="line">    @_onMouseDownY = e.clientY</span><br><span class="line"></span><br><span class="line">    @_onMouseDownLon = @_lon</span><br><span class="line">    @_onMouseDownLat = @_lat</span><br><span class="line"></span><br><span class="line">  onMouseMove: <span class="function"><span class="params">(e)</span> =&gt;</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> @_isInteracting</span><br><span class="line">    	<span class="comment"># 計算經緯度的差距，讓之後可以轉換為座標</span></span><br><span class="line">      @_lon = (@_onMouseDownX - e.clientX) * <span class="number">0.1</span> + @_onMouseDownLon</span><br><span class="line">      @_lat = (@_onMouseDownY - e.clientY) * <span class="number">0.1</span> + @_onMouseDownLat</span><br><span class="line"></span><br><span class="line">  onMouseUp: <span class="function"><span class="params">(e)</span> =&gt;</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"></span><br><span class="line">    @_isInteracting = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  onWindowResize: <span class="function">=&gt;</span></span><br><span class="line">    @camera.aspect = <span class="built_in">window</span>.innerWidth / <span class="built_in">window</span>.innerHeight</span><br><span class="line">    @camera.updateProjectionMatrix()</span><br><span class="line"></span><br><span class="line">    @renderer.setSize <span class="built_in">window</span>.innerWidth, <span class="built_in">window</span>.innerHeight</span><br></pre></td></tr></table></figure><p>到此為止，就可以順利地做出遊戲的全景預覽拉！</p><blockquote><p>所以我到底為什麼要花一個下午研究「球座標系統」轉為「直角座標系統」的算式呢？</p></blockquote><footer class="article__footer"><div class="text-center"><div class="fb-share-button" data-href="https://blog.frost.tw/posts/2015/01/13/bring-the-games-scene-into-webpage/" data-layout="button_count"></div></div><p align="center"><a href="https://ko-fi.com/J3J78093" target="_blank" rel="external nofollow noopener noreferrer"><img height="36" style="border:0;height:36px" src="https://az743702.vo.msecnd.net/cdn/kofi5.png?v=0" border="0" alt="Buy Me a Coffee at ko-fi.com"></a></p><iframe scrolling="no" frameborder="0" style="display:block;margin:0 auto;height:212px" src="https://button.like.co/in/embed/elct9620/button?referrer=https://blog.frost.tw/posts/2015/01/13/bring-the-games-scene-into-webpage/"></iframe><ul class="article__tag-list"><li class="article__tag-list-item"><a class="article__tag-list-link" href="/tags/前端/">前端</a></li><li class="article__tag-list-item"><a class="article__tag-list-link" href="/tags/心得/">心得</a></li></ul></footer></div></article><div class="adv"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2844969736316510" data-ad-slot="5530952976" data-ad-format="auto"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><section id="comment" class="comment-box"><h1 class="comment-box__title">留言</h1><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a rel="nofollow" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></div><footer id="footer"><div id="copyright">&copy;2013 <a href="https://plus.google.com/117236344655673213049?rel=author" target="_blank" rel="external nofollow noopener noreferrer">蒼時弦也</a>. All right reversed.</div></footer><script type="text/javascript">window.disqus_shortname="revo-skill-frost",function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+window.disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5TQLRN" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="//www.googletagmanager.com/gtm.js?id=GTM-5TQLRN",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><script>window.fbAsyncInit=function(){FB.init({appId:"178355449110",xfbml:!0,version:"v2.12"}),FB.AppEvents.logPageView()},function(e,n,t){var o,s=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="https://connect.facebook.net/zh_TW/sdk.js",o.async=!0,s.parentNode.insertBefore(o,s))}(document,"script","facebook-jssdk")</script><script src="/js/app.js"></script><div class="loading"></div></body></html>