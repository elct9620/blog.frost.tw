<!doctype html><html lang=zh-tw><head><title>部署你的第一個 Ruby on Rails 網站（三） - 弦而時習之</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="經過第一篇和第二篇的說明，我想大家現在應該都有辦法順利的透過 SSH 進入自己的伺服器。
在第二篇的最後，我們針對 Ruby 環境預先做了準備，接下來就是安裝 Ruby 環境的時候了！"><meta name=created content="2018-03-27T00:00:00+0000"><meta name=modified content="2018-03-27T21:30:15+0000"><meta name=author content="蒼時弦也"><meta property="og:site_name" content="弦而時習之"><meta property="og:title" content="部署你的第一個 Ruby on Rails 網站（三）"><meta property="og:url" content="https://blog.frost.tw/posts/2018/03/27/Getting-started-deploy-your-Ruby-on-Rails-Part-3/"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.frost.tw/images/getting-started-deploy-your-ruby-on-rails-part-3/thumbnail.png"><meta name=theme-color content="#EFEFEF"><link href=https://blog.frost.tw/icon-512.png rel=icon><link rel=canonical href=https://blog.frost.tw/posts/2018/03/27/Getting-started-deploy-your-Ruby-on-Rails-Part-3/><script type=application/ld+json>[{"@context":"https://schema.org","@type":"WebPage","headline":"部署你的第一個 Ruby on Rails 網站（三）","datePublished":"2018-03-27T21:30:15Z","dateModified":"2018-03-27T21:30:15Z","url":"https://blog.frost.tw/posts/2018/03/27/Getting-started-deploy-your-Ruby-on-Rails-Part-3/","description":"經過第一篇和第二篇的說明，我想大家現在應該都有辦法順利的透過 SSH 進入自己的伺服器。\n在第二篇的最後，我們針對 Ruby 環境預先做了準備，接下來就是安裝 Ruby 環境的時候了！\n","keywords":["教學","DevOps","Ruby on Rails"],"image":"https://blog.frost.tw/images/getting-started-deploy-your-ruby-on-rails-part-3/thumbnail.png","author":{"@type":"Person","name":"蒼時弦也"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.frost.tw/"},"publisher":{"@type":"Organization","name":"弦而時習之","url":"https://blog.frost.tw/"}},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://blog.frost.tw/","name":"弦而時習之","image":"http://blog.frost.tw/icon-512.png"}},{"@type":"ListItem","position":2,"item":{"@id":"https://blog.frost.tw/posts/2018/03/27/Getting-started-deploy-your-Ruby-on-Rails-Part-3/","name":"部署你的第一個 Ruby on Rails 網站（三）","image":"https://blog.frost.tw/images/getting-started-deploy-your-ruby-on-rails-part-3/thumbnail.png"}}]}]</script><script async src=/js/turbolinks.min.js></script></head><body><div id=fb-root data-turbolinks-permanent></div><h1 id=sitename><a href=/ class="hide-text logo--icon align-center">弦而時習之</a></h1><aside id=slogan class="slogan align-center text-center"><h2 class=slogan__title>Aotokitsuruya</h2><p class=slogan__description>The Web is attracting me, so I start learning PHP, HTML, CSS and JavaScript. When I know about Ruby, I fall in love with it. Now, I working with my friend to design games using C++ and still learning web about Golang, Ruby and JavaScript. In the other side, I also be a designer, the reason why the web is attracted me.</p></aside><div id=wrapper><article class="post article" role=article><header class=article__header><time datetime=2018-03-27T21:30:15+0000 class=article__time--header>Feb.27</time><h1 class=article__title>部署你的第一個 Ruby on Rails 網站（三）</h1></header><div class=article__entry><nav class=translation></nav><p>經過<a href=https://blog.frost.tw/posts/2018/03/20/Getting-started-deploy-your-Ruby-on-Rails-Part-1/>第一篇</a>和<a href=https://blog.frost.tw/posts/2018/03/23/Getting-started-deploy-your-Ruby-on-Rails-Part-2/>第二篇</a>的說明，我想大家現在應該都有辦法順利的透過 SSH 進入自己的伺服器。</p><p>在第二篇的最後，我們針對 Ruby 環境預先做了準備，接下來就是安裝 Ruby 環境的時候了！</p><h2 id=計畫>計畫</h2><p>隨著專案的發展，我們通常都會需要更新 Ruby 版本。這次我們選擇使用的是 Passenger + Ruby 的解決方案，好處是可以透過設定檔指定 Ruby 版本。為了這個優點，我們可以透過自行編譯 Ruby 來管理多個版本的 Ruby。</p><p>如果覺得自行編譯麻煩的話，也可以選擇 RVM 或者 rbenv 這兩套常見的 Ruby 版本管理工具，不過在經驗上編譯 Ruby 環境其實非常的容易，所以也就不一定需要了！</p><blockquote><p>使用這種方法是需要管理的主機不多，或者是自己使用（需要放多個網站）的情況才會這樣做，當主機多的時候，採用 Chef / Ansible 這種部署工具，一台機器針對一個網站配置，更新版本時就採取直接安裝新的伺服器後轉移過去，反而會比較好管理。</p></blockquote><h2 id=編譯-ruby>編譯 Ruby</h2><p>首先，我們要確定是在自己的使用者下執行，而非 <code>root</code> 使用者。看一下輸入指令的地方是顯示類似 <code>elct9620@deploy-example</code> 而不是 <code>root@deploy-example</code> 就能夠分辨現在使用的帳號是哪一個。</p><p><code>@</code> 前面是「使用者」後面的部分叫做 Hostname（主機名稱）可以用來分辨是在哪一台伺服器上，所以在設定的時候好好取名是很重要的。</p><blockquote><p>不論是寫程式或設定伺服器，用容易理解的命名都是一個好習慣。</p></blockquote><p>這次的範例會編譯 Ruby 2.4 版本，我們要先到 Ruby 官方網站的<a href=https://www.ruby-lang.org/zh_tw/downloads/>下載頁面</a>來取得原始碼的壓縮檔。</p><p><img src=https://blog.frost.tw/images/getting-started-deploy-your-ruby-on-rails-part-3/screenshot.jpg alt="螢幕快照 2018-03-26 下午10.17.13.png"></p><p>如圖上顯示的一樣，目前最新的 Ruby 2.4.3 是我們想安裝的版本，所以對他點選右鍵後選擇「複製連結網址」就可以取得像是下面的下載位址。</p><pre><code>https://cache.ruby-lang.org/pub/ruby/2.4/ruby-2.4.3.tar.gz
</code></pre><p>接下來我們到伺服器上用 <code>wget</code>（WWW Get）指令來下載檔案，除了 <code>curl</code> 這個之後會介紹的指令外，是在 Linux 上很常用來下載檔案的指令。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>wget https://cache.ruby-lang.org/pub/ruby/2.4/ruby-2.4.3.tar.gz
</code></pre></td></tr></table></div></div><blockquote><p>如果發現沒有 <code>wget</code> 指令的話，可以利用上次介紹過的 <code>sudo yum install wget -y</code> 來安裝。</p></blockquote><p>下載完畢後，如果不確定操作是否正確，我們可以用 <code>ls</code> (List) 指令來看看現在這個目錄（資料夾）下面有沒有這個檔案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>ls
</code></pre></td></tr></table></div></div><p>結果會類似下面這樣</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>elct9620@deploy-example ~<span class=o>]</span>$ ls
ruby-2.4.3.tar.gz
</code></pre></td></tr></table></div></div><p>既然這是一個壓縮檔，我們理所當然的要下指令對他解壓縮了！</p><p>在 Linux 中，我們通常會把檔案做成一個 <code>tar</code> 格式的檔案，然後再搭配上一個壓縮的格式（例如 Gzip 或者 Bzip2）所以才會有叫做 <code>.tar.gz</code> 或者 <code>.tgz</code> 這樣的副檔名。</p><p>而 <code>tar</code> 也是 Linux 中的一個指令，可以用來壓縮或者解壓縮檔案。下面的指令同時做了 <code>-z</code> （用 Gzip 壓縮格式）<code>-x</code>（解壓縮）<code>-v</code>（顯示檔案內容）<code>-f</code>（指定檔案）來進行解壓縮，統合起來就是「用 Gzip 格式解壓縮 <code>ruby-2.4.3.tar.gz</code> 這個檔案，並顯示內容」</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>tar -zxvf ruby-2.4.3.tar.gz
</code></pre></td></tr></table></div></div><p>執行完畢後，再次用 <code>ls</code> 看一次，會發現多出了 <code>ruby-2.4.3</code> 這個資料夾。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>elct9620@deploy-example ~<span class=o>]</span>$ ls
ruby-2.4.3  ruby-2.4.3.tar.gz
</code></pre></td></tr></table></div></div><p>為了編譯 Ruby 方便下指令，我們要先用 <code>cd</code>（Change Directory）指令，切換到 <code>ruby-2.4.3</code> 這個目錄下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ruby-2.4.3
</code></pre></td></tr></table></div></div><p>同時可能會發現原本輸入指令左方的 <code>~</code> 符號變成了 <code>ruby-2.4.3</code>，這是表示你目前所在的資料夾，透過這樣的方式就不怕迷失在 Linux 的資料夾中。</p><blockquote><p><code>~</code> 符號是一個代號，表示這個使用者的家目錄，一般 Linux 的使用者都會在 <code>/home</code> 資料夾下面有一個對應自己帳號的資料夾。</p></blockquote><p>預設的 Ruby 會安裝到 <code>/usr/local</code> 這個位置，但是如果我們希望能管理多個版本的 Ruby 就需要明確的指定位置。</p><p>我們可以透過執行 <code>configure</code> 這個檔案來對 Ruby 編譯時的行為做設定。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>./configure --prefix<span class=o>=</span>/usr/local/ruby-2.4.3
</code></pre></td></tr></table></div></div><p>不同的軟體會有不同的設定選項，如果有興趣的話可以去研究看除了指定資料夾之外還有哪些選擇。</p><blockquote><p>如果沒有跑出任何東西，麻煩回到第二篇（有修正過指令）目前 DigitalOcean 上面的 gcc 似乎只有舊版的 4 但是一樣可以使用。</p></blockquote><p>接下來，就是編譯 Ruby 了，因為 Ruby 採用了大部分 Linux 都會有的 <code>make</code>（類似 <code>rake</code> 可以幫我們自動執行各種指令） 所以我們就不需要另外的去安裝像是 <code>CMake</code> 或者 <code>Ninja</code> 之類的編譯工具。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>make
</code></pre></td></tr></table></div></div><p>這邊會比較花時間，完成之後我們可以用 <code>install</code> 動作請 <code>make</code> 幫我們放到正確的位置。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>make install
</code></pre></td></tr></table></div></div><p>不過這樣操作實際上是會發生錯誤的，因為 <code>/usr/local</code> 實際上還是所屬 <code>root</code> 我們可以用 <code>sudo</code> 指令提升權限。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo make install
</code></pre></td></tr></table></div></div><p>如此一來就能順利的在系統中把 Ruby 安裝進去了！</p><p>可以透過手動執行 <code>ruby</code> 這個執行檔來確認 <code>ruby</code> 是正確執行的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>/usr/local/ruby-2.4.3/bin/ruby -v
</code></pre></td></tr></table></div></div><p>如果能看到版本號，就是我們正確的安裝 Ruby 了。不過每次都要指定位置是很不方便的，我們可以透過改變 <code>PATH</code> 環境設定來簡化操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/ruby-2.4.3/bin:<span class=nv>$PATH</span>
</code></pre></td></tr></table></div></div><p>上面的 <code>export</code> 指令表示「從此之後都套用」後面我們將 <code>/usr/local/ruby-2.4.3/bin</code> 放在原本的 <code>PATH</code> 前面，表示優先從這個目錄開始找。</p><p>如此一來就能用 <code>ruby -v</code> 直接執行 Ruby 進行操作，不過當下次登入 SSH 因為沒有執行這段指令，就會無法使用這個功能。</p><p>如果大部分的情況都會採用 Ruby 2.4.3 的話，可以在 <code>/etc/profile.d</code> 這個資料夾放一個叫做 <code>ruby.sh</code> 的檔案。</p><pre><code>sudo vi /etc/profile.d/ruby.sh
</code></pre><p>進入 Vim 後按下 <code>i</code> 進入編輯模式，輸入以下指令</p><pre><code>export PATH=/usr/local/ruby-2.4.3/bin:$PATH
</code></pre><p>再按下 <code>:wq</code> 進行存檔，如此一下下次預設就會採用 Ruby 2.4.3 做為預設的 Ruby 執行了。</p><blockquote><p>在 <code>/etc</code> 目錄下面的變更是對整個伺服器的修改，以後不管是誰打開都會預設使用 Ruby 2.4.3 這點需要注意。</p></blockquote><h2 id=小結>小結</h2><p>這篇文章花了不少時間在處理編譯上，不過當掌握了編譯的方法後，不論是 Nginx 或者 PHP 還是其他的程式，都能夠用相同的方式編譯出來。</p><p>在遇到無法使用套件的情況下，會是非常有用的技巧。</p><p>下一篇會開始把 Passenger 和 Nginx 安裝起來，因為是透過 Passenger 提供的安裝工具，所以會比這一篇輕鬆很多。</p><footer class=article__footer><div class=text-center><div class=fb-share-button data-href="<%- page.permalink %>" data-layout=button_count></div></div><div class="text-center mt-1"><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:36px!important;height:37px!important;text-decoration:none!important;display:inline-flex!important;color:#fff!important;background-color:#000!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#fff!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie&display=swap" rel=stylesheet><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/aotoki><img src=https://bmc-cdn.nyc3.digitaloceanspaces.com/BMC-button-images/BMC-btn-logo.svg rel=noreferrer alt="Buy me a Coffee"><span style=margin-left:5px>Buy me a Coffee</span></a></div><iframe title=LikeCoin scrolling=no frameborder=0 style="display:block;margin:0 auto;height:212px" src="https://button.like.co/in/embed/elct9620/button?referrer=<%- page.permalink %>"></iframe><ul class=article__tag-list><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/tags/%E6%95%99%E5%AD%B8/>教學</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/tags/DevOps/>DevOps</a></li><li class=article__tag-list-item><a class=article__tag-list-link href=https://blog.frost.tw/tags/Ruby/>Ruby on Rails</a></li></ul></footer><aside class=related><header class=related__header><h3 class=related__title>相關文章</h3></header><ul><li class=related__item><a class=related__link href=/posts/2018/03/23/Getting-started-deploy-your-Ruby-on-Rails-Part-2/>部署你的第一個 Ruby on Rails 網站（二）</a></li><li class=related__item><a class=related__link href=/posts/2018/03/20/Getting-started-deploy-your-Ruby-on-Rails-Part-1/>部署你的第一個 Ruby on Rails 網站（一）</a></li><li class=related__item><a class=related__link href=/posts/2018/03/24/Google-Analytics-not-correct-when-using-turbolinks/>使用 Turbolinks 時 Google Analytics 並沒有正確運作</a></li><li class=related__item><a class=related__link href=/posts/2018/03/18/The-easy-way-not-best-way-learn-from-Apartment-and-Globalize/>Apartment 與 Globalize 隱藏在方便背後的陷阱</a></li><li class=related__item><a class=related__link href=/posts/2018/03/18/A-tips-for-manage-ruby-on-rails-s-vendor-assets/>管理 Ruby on Rails 外部 Assets 的小技巧</a></li></ul></aside></div></article><div class=adv><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-2844969736316510 data-ad-slot=5530952976 data-ad-format=auto></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><section id=comment class=comment-box><h1 class=comment-box__title>留言</h1><div id=disqus_thread></div></div></section></div><footer id=footer><div id=copyright>&copy;2020 <a href="https://plus.google.com/117236344655673213049?rel=author" target=_blank rel=noreferrer>蒼時弦也</a>. All right reversed.</div></footer><link rel=stylesheet href=/css/styls.css><script src=/js/app.min.6e03bcf752b31ab875459fbdd360c766632ead24687ffe499c4cf1f86e9fe489.js></script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5TQLRN" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5TQLRN');</script><script>window.fbAsyncInit=function(){FB.init({appId:'178355449110',xfbml:true,version:'v2.12'});FB.AppEvents.logPageView();};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/zh_TW/sdk.js";js.async=true
js.defer=true
fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));</script><div class=loading></div></body></html>